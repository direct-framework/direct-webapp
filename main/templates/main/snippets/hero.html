{% load static %}
<section class="position-relative pt-5">
    <div class="position-absolute top-0 start-0 w-100" style="height: 79%;">
        <div class="bg-primary position-absolute top-0 start-0 w-100 h-100"></div>
        <div class="position-absolute start-0 bottom-0 w-100 overflow-hidden mb-n1"
             style="padding-bottom: 6.2%;
                    color: var(--ar-body-bg)">
            <svg class="position-absolute start-0 bottom-0 w-100 h-100"
                 viewBox="0 0 3000 185.4"
                 xmlns="http://www.w3.org/2000/svg">
                <path fill="currentColor" d="M3000,0v185.4H0V0c496.4,115.6,996.4,173.4,1500,173.4S2503.6,115.6,3000,0z"></path>
            </svg>
        </div>
    </div>
    <svg class="position-absolute end-0 z-2 mt-4 mt-sm-5"
         width="836"
         height="755"
         fill="none"
         stroke="white"
         stroke-miterlimit="10"
         xmlns="http://www.w3.org/2000/svg">
        <path d="M21.253 754.495c-18.309-66.796-31.642-139.581-6.067-203.929 33.531-84.307 126.54-131.543 216.622-142.348 90.082-10.831 180.803 7.052 271.284 13.945s187.376.931 261.969-50.776C868.476 299.694 902.433 159.981 995.762 75.54 1073.58 5.151 1191.04-18.081 1289.8 17.446M89.774 754.494c-17.324-63.177-29.938-132.049-5.748-192.911 31.722-79.756 119.701-124.438 204.913-134.657 85.239-10.246 171.036 6.68 256.621 13.2s177.263.878 247.812-48.035c97.852-67.835 129.947-199.99 218.248-279.853 73.61-66.584 184.74-88.565 278.15-54.954M158.305 754.496c-16.313-59.585-28.235-124.492-5.402-181.894 29.912-75.206 112.862-117.333 193.231-126.966 80.368-9.661 161.269 6.307 241.983 12.427 80.715 6.148 167.151.825 233.655-45.293 92.264-63.949 122.522-188.574 205.768-263.886 69.4-62.805 174.17-83.509 262.26-51.814M226.834 754.495c-15.328-55.965-26.532-116.96-5.083-170.876 28.103-70.655 106.023-110.228 181.521-119.276 75.499-9.074 151.503 5.908 227.321 11.683s157.011.772 219.497-42.553c86.675-60.09 115.097-177.157 193.31-247.891 65.2-59 163.64-78.453 246.37-48.674M295.359 754.495c-14.344-52.372-24.802-109.429-4.763-159.859 26.266-66.104 99.183-103.122 169.812-111.584 70.628-8.489 141.736 5.535 212.657 10.937s146.899.719 205.366-39.811c81.087-56.205 107.699-165.741 180.859-231.925 60.99-55.193 153.1-73.396 230.48-45.533" stroke-opacity=".12">
        </path>
    </svg>
    <div class="container position-relative z-5 pt-5 mt-4 mt-lg-5"
         data-bs-theme="dark">
        <div class="row justify-content-center text-center pt-md-2 pt-lg-0 pt-xl-2 pb-5 mb-md-2">
            <div class="col-lg-10 col-xl-9 col-xxl-8">
                <h1 class="display-3 mb-sm-4">Digital Research Competencies Framework</h1>
                <p class="text-body pb-3 mb-3 mb-lg-4">
                    Identify skills, define development pathways and progress your career in research software
                </p>
            </div>
        </div>
        <div class="mx-auto">
            <div class="row g-4 mb-3 mb-xl-0">
                <div class="col-md-5 col-lg-4 order-md-1">
                    <div class="card border-0 rounded-2 bg-dark h-100 px-xl-4 pb-sm-2 pb-xl-4">
                        <div class="card-body">
                            <h3>Explore Roles with the Skills Wheel</h3>
                            <p class="card-text">
                                The Skills Wheel provides a clear, visual overview of the competencies that make up a digital research role.
                                It shows how technical expertise, research knowledge, and professional skills come together, helping you
                                identify strengths, spot areas for growth, and plan your development. Use the wheel to reflect on your own skills
                                and understand how your role contributes to the wider research landscape.
                            </p>
                            <a class="btn btn-primary mt-2" href="{% url 'roles' %}">View Sample Roles</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-7 col-lg-8 order-md-2">
                    <div class="card border-0 rounded-2 h-100 bg-skill-wheel">
                        <div id="dataviz_hero"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <br />
</section>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const datavizRoot = document.getElementById('dataviz_hero');
    const sampleData = {{ sample_data|safe }};
    const skillLevelsLoadedFromContext = {{ skill_levels|safe }};

    // Function to load sample data for a given user
    function loadProfileData(userId) {
        const profile = sampleData.find(u => u.user_id === userId);
        return profile || { user_data: [], role: 'Unknown Role' };
    }

    // Function to render the radial bar chart
    function renderSkillWheel(userData) {
        const radialBarChartConfig = {
            innerRadius: 0,
            width: 900,
            innerRadius: 200,
            outerPadding: 80,
            categoryPadding: 0.1,
            skillPadding: 0.05,
            arcPercent: 0.8,
            arcStartOffset: 0.1,
            annotationPadding: 10,
            lineThickness: 2,
            labelTextColor: "white",
            lvlTextColor: "var(--ar-primary)",
            lvlArcColor: "rgba(var(--ar-primary-rgb), 0.2)",
            colourList: [
                "#4E79A7", // blue
                "#F28E2B", // orange
                "#E15759", // red
                "#76B7B2", // teal
                "#59A14F", // green
                "#EDC948", // yellow
                "#B07AA1", // purple
                "#FF9DA7", // pink
                "#9C755F", // brown
                "#BAB0AC", // grey
            ],
        };

        // Clear existing chart
        datavizRoot.innerHTML = '';

        main().RadialBarChart({
            target: datavizRoot,
            data: userData,
            levels: skillLevelsLoadedFromContext,
            config: radialBarChartConfig,
        });
    }

    // Expose function globally for button onclick
    window.loadSkillWheel = function(profileId) {
        const profile = loadProfileData(profileId);

        // Render the skill wheel
        renderSkillWheel(profile.user_data);
    };

    // Initially render first profile
    loadSkillWheel(1);
});
</script>
